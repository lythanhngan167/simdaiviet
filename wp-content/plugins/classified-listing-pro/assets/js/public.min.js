!function(e){e(document).on("click",".mark-as-sold",(function(t){t.preventDefault();var a=this,r=e(a),n={action:"rtcl_mark_as_sold_unsold",post_id:parseInt(r.attr("data-id"),10),__rtcl_wpnonce:rtcl.__rtcl_wpnonce};n.post_id&&!r.hasClass("working")&&e.ajax({url:rtcl.ajaxurl,data:n,type:"POST",beforeSend:function(){r.addClass("working")},success:function(t){r.removeClass("working"),t.target=a,t.success&&(r.attr("data-title",t.data.text).attr("data-tooltip",t.data.text).html(t.data.text),"sold"===t.data.type?r.addClass("sold"):r.removeClass("sold")),e(document).trigger("rtcl.mark_as_sold",t)},error:function(t){e(document).trigger("rtcl.mark_as_sold.error",{listing_id:n.post_id,target:a}),r.removeClass("working")}})})),e.fn.validate&&e(".rtcl #commentform").validate({submitHandler:function(t){var a,r=e(t),n=r.find("#rating"),s=n.parent(".form-group"),l=n.val(),i=e('<div class="alert" />'),o=e("#comments"),d=e(".comment-list"),c=(e("#cancel-comment-reply-link"),r.find(".btn"));if(n.length>0&&!l)return s.addClass("has-danger"),s.find(".with-errors").remove(),s.append('<div class="with-errors help-block">'+rtcl.i18n_required_rating_text+"</div>"),!1;var m=new FormData(t);return m.append("action","rtcl_ajax_submit_comment"),e.ajax({url:rtcl.ajaxurl,data:m,type:"POST",dataType:"json",cache:!1,processData:!1,contentType:!1,beforeSend:function(){e('<span class="rtcl-icon-spinner animate-spin"></span>').insertAfter(r.find(".btn")),c.val("Loading...").prop("disabled",!0),r.next(".alert").remove()},success:function(n){r.find(".btn").next(".rtcl-icon-spinner").remove(),c.prop("disabled",!1),i.html(n.message).insertAfter(r),n.error?i.addClass("alert-danger"):(i.addClass("alert-success"),n.comment_id&&e("#li-comment-"+n.comment_id).slideUp(250,(function(){e(this).remove()})),d.length>0?d.append(n.comment_html):(a='<ol class="comment-list">'+n.comment_html+"</ol>",o.append(e(a))),t.reset(),r.find("p.stars").removeClass("selected"))},complete:function(){c.val("Submit").prop("disabled",!1)},error:function(e,t,a){if(r.next(".rtcl-icon-spinner").remove(),c.val("Submit").prop("disabled",!1),500===t)alert("Error while adding comment");else if("timeout"===t)alert("Error: Server doesn't respond.");else{var n=e.responseText.split("<p>")[1].split("</p>");alert(n[0])}}}),!1}}),e(".rtcl-rating-filter .ui-link-tree-item").on("click",(function(){var t=e(this),a=t.data("id")||0,r=t.parents(".ui-accordion-content"),n=r.find("input[type=hidden]");t.hasClass("selected")?(r.find("li").removeClass("selected"),n.val("")):(r.find("li").removeClass("selected"),t.addClass("selected"),n.val(a)),t.closest("form").submit()}))}(jQuery);
